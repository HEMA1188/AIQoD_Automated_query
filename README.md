# Automated Data Query and Retrieval System

## Overview

This system allows users to query data stored in a MongoDB database using natural language. It loads data from a CSV file into MongoDB, uses an offline Large Language Model (LLM) via Ollama to translate user queries into MongoDB find() queries, executes these queries, and then displays or saves the results to a new CSV file.

## Setup and Installation

1.  **Install Dependencies:**
    ```bash
    pip install pymongo pandas langchain
    ```
2.  **Install and Run Ollama:**
    * Follow the installation instructions for Ollama on your operating system from the official Ollama website ([https://ollama.ai/](https://ollama.ai/)).
    * Once installed, run Ollama in your terminal:
        ```bash
        ollama
        ```
    * Pull the LLM you want to use. For example, to use `llama3`:
        ```bash
        ollama pull llama3
        ```
        Update the `OLLAMA_MODEL` variable in the `data_query_system.py` script if you choose a different model.
3.  **Ensure MongoDB is Running:**
    * Make sure your MongoDB server is running and accessible at `mongodb://127.0.0.1:27017/`.

## Usage

1.  **Prepare your CSV data:** Place your CSV file (e.g., `sample_data.csv`) in the same directory as the Python script or provide the correct path in the `main()` function.
2.  **Run the Python script:**
    ```bash
    sample.py
    ```
3.  **Enter your queries:** The script will prompt you to enter your data query in natural language. For example:
    ```
    Enter your data query (or type 'exit' to quit): What are the products with a price greater than 50?
    ```
4.  **Choose output format:** The script will ask if you want to 'display' the results in the console or 'save' them to a CSV file.
5.  **Save to CSV (optional):** If you choose to save, you will be prompted to enter a filename for the new CSV file.
6.  **View generated queries:** The MongoDB queries generated by the LLM for each user input will be saved in the `Queries_generated.txt` file.
7.  **Exit:** Type `exit` when you are finished querying the data.

## Code Documentation

The Python script `sample.py` contains the following key functions:

* `load_csv_to_mongodb(csv_file_path, mongo_host, database_name, collection_name)`: Loads data from a specified CSV file into a MongoDB collection.
* `generate_mongodb_query(user_input, collection_fields)`: Takes a user's natural language query and the fields of the MongoDB collection as input and uses the Ollama LLM to generate a MongoDB `find()` query string (as a Python dictionary).
* `retrieve_and_present_data(mongo_host, database_name, collection_name, mongodb_query_string, output_format="display", output_filename=None)`: Executes the generated MongoDB query, retrieves the matching data, and either displays it in the console or saves it to a new CSV file.
* `main()`: The main function that orchestrates the data loading, user interaction loop, query generation, and data retrieval processes.

The script uses the `pymongo` library for interacting with MongoDB, `pandas` for handling CSV data and displaying results, `langchain` for interfacing with the Ollama LLM, and `json` for parsing the generated query string.

## Error Handling

The script includes basic error handling for:

* Issues during CSV loading into MongoDB.
* Errors when generating queries using the LLM.
* Invalid JSON format of the generated MongoDB query.
* Problems connecting to or retrieving data from MongoDB.
* Invalid user input for output format.

## Additional Notes

* Ensure that your Ollama server is running and the specified model is available.
* The performance of the query generation depends on the LLM you are using and the complexity of the user query.
* For more complex natural language queries, you might consider using more advanced techniques like LlamaIndex to provide the LLM with better context about your data schema and contents.
